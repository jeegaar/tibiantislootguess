<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tibiantis ‚Äî Loot Guess</title>
<style>
  :root {
    --bg:#0c0f12;--panel:#1a1f24;--text:#e6edf3;--muted:#9aa7b1;
    --green:#2e7d32;--red:#c62828;--accent:#ffcc00;--border:#26323a;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,Arial,sans-serif;
    background:linear-gradient(180deg,#0c0f12,#12161a);
    color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;
  }
  .app{width:100%;max-width:900px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:18px;}
  h1{margin:0;color:var(--accent);text-align:center;font-size:1.3rem;}
  .hidden{display:none}
  .help{color:var(--muted);font-size:0.95rem;margin:10px 0;text-align:center}

  .row{display:grid;grid-template-columns:1fr auto auto;gap:8px;margin-top:10px}
  input[type=text]{padding:10px;border-radius:8px;border:1px solid var(--border);background:#0f1419;color:var(--text)}
  button{padding:10px 12px;border-radius:8px;border:1px solid var(--border);background:#0f1419;color:var(--text);cursor:pointer}

  #lootArea{display:flex;justify-content:center;gap:12px;margin:18px 0;flex-wrap:wrap}
  #lootArea img{width:48px;height:48px;object-fit:contain;border:1px solid var(--border);border-radius:8px;background:#0f1419;padding:6px}

  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;color:#fff;font-size:0.85rem}
  .ok{background:var(--green)}.no{background:var(--red)}

  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center}
  .modal{background:var(--panel);padding:20px;border-radius:12px;border:1px solid var(--border);max-width:420px;text-align:center}
  .modal h2{margin:0 0 8px;color:var(--accent)}
</style>
</head>
<body>
<div class="app">
  <h1>üêâ Tibiantis ‚Äî Loot Guess</h1>
  <div id="welcome">
    <div class="help">Welcome to Guess the Tibiantis monster based on its loot!</div>
    <button id="startBtn">Start the game!</button>
  </div>

  <div id="gameArea" class="hidden">
    <div class="help">Guess today's creature. A random loot item is revealed first. Each wrong guess shows another item.</div>
    <div id="lootArea"></div>

    <div class="row">
      <input id="guessInput" placeholder="Type a creature name‚Ä¶" autocomplete="off" />
      <button id="guessBtn">Guess</button>
      <button id="resetBtn">Reset</button>
    </div>

    <table>
      <thead><tr><th>Name</th><th>Status</th></tr></thead>
      <tbody id="guessesBody"></tbody>
    </table>
    <div id="message"></div>
  </div>
</div>

<script>
const ITEMS_URL = "/items.json";
const MONSTER_LOOT_URL = "/monster_loot.json";

const norm = v => (v??'').toLowerCase().trim();
function getWarsawDateKey(){
  const fmt=new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'});
  return fmt.format(new Date());
}
function hashStr(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

let ITEMS={}, MONSTER_LOOT={}, TARGET=null, LOOT_LIST=[], revealed=0, solved=false;

async function initData(){
  ITEMS = await fetch(ITEMS_URL).then(r=>r.json());
  MONSTER_LOOT = await fetch(MONSTER_LOOT_URL).then(r=>r.json());

  const monsters = Object.keys(MONSTER_LOOT);
  const idx = hashStr(getWarsawDateKey()) % monsters.length;
  TARGET = monsters[idx];
  const lootNames = MONSTER_LOOT[TARGET] || [];
  LOOT_LIST = lootNames.map(n => ({ name:n, icon:ITEMS[norm(n)] || "icons/unknown.png" }));
  shuffle(LOOT_LIST);
}

function revealNextLoot(){
  if(revealed >= LOOT_LIST.length) return;
  const item = LOOT_LIST[revealed++];
  const img = document.createElement("img");
  img.src = item.icon;
  img.title = item.name;
  document.getElementById("lootArea").appendChild(img);
}

function makeGuess(){
  const val = document.getElementById("guessInput").value.trim();
  if(!val) return;
  const correct = norm(val) === norm(TARGET);
  const tr=document.createElement("tr");
  const td1=document.createElement("td");td1.textContent=val;
  const td2=document.createElement("td");
  const badge=document.createElement("span");
  badge.className="badge "+(correct?"ok":"no");
  badge.textContent=correct?"Correct":"Wrong";
  td2.appendChild(badge); tr.appendChild(td1); tr.appendChild(td2);
  document.getElementById("guessesBody").prepend(tr);
  if(correct){
    solved=true;
    document.getElementById("message").textContent="üéâ Correct! The monster is "+TARGET;
    showWinModal();
  }else{
    revealNextLoot();
  }
  document.getElementById("guessInput").value="";
}

function showWinModal(){
  const backdrop=document.createElement("div");backdrop.className="modal-backdrop";
  const modal=document.createElement("div");modal.className="modal";
  const h=document.createElement("h2");h.textContent="You Guessed Right!";
  modal.appendChild(h);
  backdrop.appendChild(modal);
  backdrop.addEventListener("click",()=>document.body.removeChild(backdrop));
  document.body.appendChild(backdrop);
}

document.getElementById("startBtn").addEventListener("click", async ()=>{
  await initData();
  document.getElementById("welcome").classList.add("hidden");
  document.getElementById("gameArea").classList.remove("hidden");
  revealNextLoot(); // show first item immediately
});
document.getElementById("guessBtn").addEventListener("click", makeGuess);
document.getElementById("guessInput").addEventListener("keydown", e=>{if(e.key==="Enter") makeGuess();});
document.getElementById("resetBtn").addEventListener("click", ()=>{
  location.reload();
});
</script>
</body>
</html>
