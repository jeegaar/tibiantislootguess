<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tibiantis ‚Äî Loot Guess</title>
<style>
  body{
    margin:0;font-family:Arial, sans-serif;
    background:#0c0f12;color:#e6edf3;
    display:flex;justify-content:center;align-items:center;min-height:100vh;
  }
  .app{max-width:800px;width:100%;background:#1a1f24;
    padding:20px;border:1px solid #26323a;border-radius:12px}
  h1{color:#ffcc00;text-align:center;margin:0 0 10px}
  .hidden{display:none}
  #lootArea{display:flex;justify-content:center;gap:12px;margin:15px 0;flex-wrap:wrap}
  .loot-badge{
    padding:10px 14px;border-radius:8px;background:#0f1419;
    border:1px solid #26323a;color:#e6edf3;font-size:0.9rem
  }
  .row{display:grid;grid-template-columns:1fr auto;gap:8px;margin-bottom:10px}
  input{padding:10px;border-radius:8px;border:1px solid #26323a;background:#0f1419;color:#e6edf3}
  button{padding:10px 12px;border-radius:8px;border:1px solid #26323a;background:#0f1419;color:#e6edf3;cursor:pointer}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #26323a;text-align:left}
  .badge{padding:4px 8px;border-radius:999px;color:#fff;font-size:0.8rem}
  .ok{background:#2e7d32}.no{background:#c62828}
</style>
</head>
<body>
<div class="app">
  <h1>üêâ Tibiantis Loot Guess</h1>

  <div id="welcome">
    <p style="text-align:center">Welcome to Guess the Tibiantis monster based on its loot!</p>
    <button id="startBtn">Start the game!</button>
  </div>

  <div id="gameArea" class="hidden">
    <div id="lootArea"></div>

    <div class="row">
      <input id="guessInput" placeholder="Type a creature name‚Ä¶" />
      <button id="guessBtn">Guess</button>
    </div>

    <table>
      <thead><tr><th>Name</th><th>Status</th></tr></thead>
      <tbody id="guessesBody"></tbody>
    </table>

    <div id="message"></div>
  </div>
</div>

<script>
const MONSTER_LOOT_URL = "/monster_loot.json";
const ITEMS_URL = "/items.json"; // optional icons (not required now)

const norm = s => (s||"").toLowerCase().trim();
function getWarsawDateKey(){
  const fmt=new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'});
  return fmt.format(new Date());
}
function hashStr(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}

let TARGET=null, LOOT_LIST=[], revealed=0;

async function initGame(){
  const monsters = await fetch(MONSTER_LOOT_URL).then(r=>r.json());
  const names = Object.keys(monsters);
  const idx = hashStr(getWarsawDateKey()) % names.length;
  TARGET = names[idx];
  LOOT_LIST = monsters[TARGET] || [];

  document.getElementById("welcome").classList.add("hidden");
  document.getElementById("gameArea").classList.remove("hidden");

  if(LOOT_LIST.length===0){
    document.getElementById("lootArea").textContent="This monster doesn't loot a thing!!!";
  } else {
    shuffle(LOOT_LIST);
    revealNextLoot();
  }
}

function revealNextLoot(){
  if(revealed>=LOOT_LIST.length) return;
  const name=LOOT_LIST[revealed++];
  const div=document.createElement("div");
  div.className="loot-badge";
  div.textContent=name;
  document.getElementById("lootArea").appendChild(div);
}

function makeGuess(){
  const guess=document.getElementById("guessInput").value.trim();
  if(!guess) return;
  const correct=norm(guess)===norm(TARGET);
  const tr=document.createElement("tr");
  const td1=document.createElement("td");td1.textContent=guess;
  const td2=document.createElement("td");
  const badge=document.createElement("span");
  badge.className="badge "+(correct?"ok":"no");
  badge.textContent=correct?"Correct":"Wrong";
  td2.appendChild(badge);tr.appendChild(td1);tr.appendChild(td2);
  document.getElementById("guessesBody").prepend(tr);
  if(correct){
    document.getElementById("message").textContent="üéâ Correct! It was "+TARGET+"!";
  } else {
    revealNextLoot();
  }
  document.getElementById("guessInput").value="";
}

document.getElementById("startBtn").addEventListener("click",initGame);
document.getElementById("guessBtn").addEventListener("click",makeGuess);
document.getElementById("guessInput").addEventListener("keydown",e=>{if(e.key==="Enter") makeGuess();});
</script>
</body>
</html>
